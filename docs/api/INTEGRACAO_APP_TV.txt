================================================================================
  INTEGRA√á√ÉO DO APLICATIVO TV COM API - SISTEMA DE INTERCALA√á√ÉO
================================================================================

üìÖ Atualizado em: 02/11/2025
üîó API Base URL: https://expotv-backend.fly.dev
üì∫ Sistema: EXPO TV - Gest√£o de Conte√∫do para Condom√≠nios

================================================================================
  1. ENDPOINT PRINCIPAL PARA TVs
================================================================================

GET /app/tv/{codigo_conexao}/content

DESCRI√á√ÉO:
  Retorna todo o conte√∫do (avisos, an√∫ncios e not√≠cias) j√° INTERCALADO
  na ordem correta de exibi√ß√£o, respeitando as propor√ß√µes configuradas
  no painel administrativo para cada TV.

PAR√ÇMETROS:
  - codigo_conexao: C√≥digo √∫nico da TV (fornecido no cadastro)

EXEMPLO DE REQUISI√á√ÉO:
  GET https://expotv-backend.fly.dev/app/tv/ABC123XYZ/content

RESPOSTA (JSON):
{
  "success": true,
  "tv": {
    "id": 5,
    "nome": "TV Lobby Principal",
    "codigo_conexao": "ABC123XYZ",
    "template": "Layout 1"
  },
  "config": {
    "proporcao_avisos": 1,
    "proporcao_anuncios": 5,
    "proporcao_noticias": 3,
    "descricao": "1 aviso(s) : 5 an√∫ncio(s) : 3 not√≠cia(s)"
  },
  "content": [
    {
      "type": "aviso",
      "data": {
        "id": 10,
        "nome": "Manuten√ß√£o Elevador",
        "descricao": "Elevador em manuten√ß√£o hoje",
        "imagem_url": "https://...",
        "video_url": null,
        "status": "Ativo"
      }
    },
    {
      "type": "anuncio",
      "data": {
        "id": 25,
        "nome": "Promo√ß√£o Mercado",
        "descricao": "50% OFF em frutas",
        "imagem_url": "https://...",
        "video_url": null,
        "tempo_exibicao": 10,
        "status": "Ativo"
      }
    },
    {
      "type": "anuncio",
      "data": {
        "id": 26,
        "nome": "Academia Local",
        "descricao": "Matricula gr√°tis",
        "imagem_url": "https://...",
        "tempo_exibicao": 15
      }
    },
    ... (mais 3 an√∫ncios seguidos)
    {
      "type": "noticia",
      "data": {
        "title": "Economia cresce 2% no trimestre",
        "description": "Segundo dados do IBGE...",
        "url": "https://jovempan.com.br/...",
        "urlToImage": "https://jpimg.com.br/...",
        "publishedAt": "2025-11-02T10:30:00Z",
        "source": "üéôÔ∏è Jovem Pan"
      }
    },
    ... (mais 2 not√≠cias seguidas)
  ],
  "stats": {
    "total_items": 45,
    "avisos": 5,
    "anuncios": 25,
    "noticias": 15
  }
}

================================================================================
  2. COMO FUNCIONA A INTERCALA√á√ÉO (ROUND-ROBIN)
================================================================================

A PROPOR√á√ÉO define QUANTOS ITENS SEGUIDOS de cada tipo aparecem por RODADA.

EXEMPLO: Config "1:5:3" significa:

  RODADA 1:
    ‚îú‚îÄ Exibir 1 AVISO
    ‚îú‚îÄ Exibir 1 AN√öNCIO
    ‚îú‚îÄ Exibir 1 AN√öNCIO
    ‚îú‚îÄ Exibir 1 AN√öNCIO
    ‚îú‚îÄ Exibir 1 AN√öNCIO
    ‚îú‚îÄ Exibir 1 AN√öNCIO (5 an√∫ncios seguidos!)
    ‚îú‚îÄ Exibir 1 NOT√çCIA
    ‚îú‚îÄ Exibir 1 NOT√çCIA
    ‚îî‚îÄ Exibir 1 NOT√çCIA (3 not√≠cias seguidas!)

  RODADA 2:
    ‚îú‚îÄ Exibir 1 AVISO
    ‚îú‚îÄ 5 AN√öNCIOS seguidos...
    ‚îî‚îÄ 3 NOT√çCIAS seguidas...

  ... REPETE at√© acabar o conte√∫do dispon√≠vel


OUTRO EXEMPLO: Config "1:2:1"

  RODADA 1:
    ‚îú‚îÄ 1 AVISO
    ‚îú‚îÄ 1 AN√öNCIO
    ‚îú‚îÄ 1 AN√öNCIO (2 seguidos!)
    ‚îî‚îÄ 1 NOT√çCIA

  RODADA 2:
    ‚îú‚îÄ 1 AVISO
    ‚îú‚îÄ 2 AN√öNCIOS
    ‚îî‚îÄ 1 NOT√çCIA

  ... REPETE


EXEMPLO EXTREMO: Config "0:1:0" (apenas an√∫ncios)

  RODADA 1:
    ‚îî‚îÄ 1 AN√öNCIO
  
  RODADA 2:
    ‚îî‚îÄ 1 AN√öNCIO
  
  ... REPETE


================================================================================
  3. L√ìGICA DE EXIBI√á√ÉO NO APLICATIVO
================================================================================

PSEUDOC√ìDIGO:

  1. Fazer requisi√ß√£o GET /app/tv/{codigo}/content
  2. Guardar o array "content" retornado
  3. Para cada item no array "content":
     
     a) Verificar o campo "type":
        - Se type == "aviso":
            * Exibir item.data.imagem_url (se tiver)
            * OU exibir item.data.video_url (se tiver)
            * Dura√ß√£o: 10 segundos (padr√£o para avisos)
        
        - Se type == "anuncio":
            * Exibir item.data.imagem_url (se tiver)
            * OU exibir item.data.video_url (se tiver)
            * Dura√ß√£o: item.data.tempo_exibicao segundos
        
        - Se type == "noticia":
            * Layout 1: Exibir no rodap√©/banner inferior
            * Layout 2: Exibir em tela cheia
            * Usar item.data.title, description, urlToImage
            * Dura√ß√£o: 15 segundos (padr√£o para not√≠cias)
     
     b) Aguardar o tempo de exibi√ß√£o
     c) Passar para o pr√≥ximo item
  
  4. Quando terminar o array, VOLTAR ao in√≠cio (loop infinito)
  5. A cada X minutos (sugest√£o: 5 min), refazer requisi√ß√£o para atualizar conte√∫do


EXEMPLO EM C√ìDIGO (JavaScript/TypeScript):

```javascript
async function carregarConteudo() {
  const response = await fetch(
    'https://expotv-backend.fly.dev/app/tv/ABC123XYZ/content'
  );
  const data = await response.json();
  return data.content; // Array de itens intercalados
}

async function exibirConteudo() {
  const content = await carregarConteudo();
  let index = 0;

  while (true) {
    const item = content[index];
    
    if (item.type === 'aviso') {
      // Exibir aviso
      if (item.data.video_url) {
        await exibirVideo(item.data.video_url, 10);
      } else if (item.data.imagem_url) {
        await exibirImagem(item.data.imagem_url, 10);
      }
    } 
    else if (item.type === 'anuncio') {
      // Exibir an√∫ncio
      const duracao = item.data.tempo_exibicao || 10;
      if (item.data.video_url) {
        await exibirVideo(item.data.video_url, duracao);
      } else if (item.data.imagem_url) {
        await exibirImagem(item.data.imagem_url, duracao);
      }
    }
    else if (item.type === 'noticia') {
      // Exibir not√≠cia
      await exibirNoticia({
        titulo: item.data.title,
        descricao: item.data.description,
        imagem: item.data.urlToImage
      }, 15);
    }
    
    // Pr√≥ximo item
    index++;
    if (index >= content.length) {
      index = 0; // Volta pro in√≠cio
      // Opcional: Recarregar conte√∫do
      content = await carregarConteudo();
    }
  }
}
```


================================================================================
  4. TIPOS DE LAYOUT
================================================================================

A TV tem um campo "template" que define como exibir:

LAYOUT 1 (Rodap√©):
  - Avisos: Tela cheia
  - An√∫ncios: Tela cheia
  - Not√≠cias: Banner no rodap√© (texto correndo) enquanto exibe avisos/an√∫ncios

LAYOUT 2 (Tela Cheia):
  - Avisos: Tela cheia
  - An√∫ncios: Tela cheia
  - Not√≠cias: Tela cheia (intercaladas normalmente)


================================================================================
  5. CAMPOS IMPORTANTES
================================================================================

AVISOS:
  - id: Identificador √∫nico
  - nome: T√≠tulo do aviso
  - descricao: Texto descritivo
  - imagem_url: URL da imagem (pode ser null)
  - video_url: URL do v√≠deo (pode ser null)
  - status: "Ativo" ou "Inativo"
  - data_expiracao: Data/hora de expira√ß√£o (pode ser null)

AN√öNCIOS:
  - id: Identificador √∫nico
  - nome: T√≠tulo do an√∫ncio
  - descricao: Texto descritivo
  - imagem_url: URL da imagem (pode ser null)
  - video_url: URL do v√≠deo (pode ser null)
  - tempo_exibicao: Segundos para exibir (ex: 10, 15, 30)
  - status: "Ativo" ou "Inativo"
  - data_expiracao: Data/hora de expira√ß√£o (pode ser null)

NOT√çCIAS (sempre da Jovem Pan üéôÔ∏è):
  - title: T√≠tulo da not√≠cia
  - description: Resumo (max 200 caracteres)
  - url: Link para mat√©ria completa
  - urlToImage: URL da imagem de capa
  - publishedAt: Data/hora de publica√ß√£o (ISO 8601)
  - source: Sempre "üéôÔ∏è Jovem Pan"


================================================================================
  6. TRATAMENTO DE ERROS
================================================================================

SE A TV N√ÉO FOR ENCONTRADA:
{
  "detail": "TV n√£o encontrada com este c√≥digo"
}
Status: 404

SE N√ÉO HOUVER CONTE√öDO:
{
  "success": true,
  "content": [],
  "stats": {
    "total_items": 0,
    "avisos": 0,
    "anuncios": 0,
    "noticias": 0
  }
}
Status: 200

RECOMENDA√á√ÉO:
  - Se content[] estiver vazio, exibir tela de "Aguardando conte√∫do"
  - Tentar novamente ap√≥s 1 minuto


================================================================================
  7. OTIMIZA√á√ïES E BOAS PR√ÅTICAS
================================================================================

1. CACHE LOCAL:
   - Guardar o conte√∫do em mem√≥ria
   - Atualizar a cada 5 minutos (ou menos se necess√°rio)

2. PR√â-CARREGAMENTO:
   - Baixar imagens/v√≠deos com anteced√™ncia
   - Evitar travamentos durante exibi√ß√£o

3. TRATAMENTO DE M√çDIA:
   - Verificar se imagem_url ou video_url existem antes de exibir
   - Ter imagem/v√≠deo de fallback para casos de erro

4. TRANSI√á√ïES:
   - Usar fade in/out entre conte√∫dos
   - Evitar cortes bruscos

5. LOG DE EXIBI√á√ÉO:
   - Registrar qual conte√∫do foi exibido e quando
   - √ötil para relat√≥rios de audi√™ncia


================================================================================
  8. ENDPOINT ALTERNATIVO (MODO LEGADO)
================================================================================

Se por algum motivo precisar buscar conte√∫do SEM intercala√ß√£o:

GET /app/content/{condominio_id}

Retorna conte√∫do separado por tipo:
{
  "anuncios": [...],
  "avisos": [...],
  "news": [...],
  "total_anuncios": 10,
  "total_avisos": 5,
  "total_news": 15
}

Com par√¢metro ?intercalado=true, retorna intercalado:

GET /app/content/123?intercalado=true&proporcao_avisos=1&proporcao_anuncios=5&proporcao_noticias=3


================================================================================
  9. RESUMO - CHECKLIST DE IMPLEMENTA√á√ÉO
================================================================================

‚òê 1. Implementar requisi√ß√£o GET /app/tv/{codigo}/content
‚òê 2. Parsear resposta JSON
‚òê 3. Iterar sobre array "content"
‚òê 4. Para cada item, verificar "type" (aviso/anuncio/noticia)
‚òê 5. Exibir m√≠dia (imagem ou v√≠deo) conforme tipo
‚òê 6. Respeitar tempo de exibi√ß√£o:
     - Avisos: 10s (padr√£o)
     - An√∫ncios: usar campo "tempo_exibicao"
     - Not√≠cias: 15s (padr√£o)
‚òê 7. Implementar loop infinito (volta ao in√≠cio quando terminar)
‚òê 8. Implementar atualiza√ß√£o peri√≥dica (a cada 5 min)
‚òê 9. Tratar casos de erro (sem conte√∫do, rede offline, etc)
‚òê 10. Implementar pre-load de m√≠dias
‚òê 11. Adicionar transi√ß√µes suaves


================================================================================
  10. SUPORTE E D√öVIDAS
================================================================================

Backend:    https://expotv-backend.fly.dev
Docs API:   https://expotv-backend.fly.dev/docs
Frontend:   https://expotv.com.br

Para d√∫vidas sobre a integra√ß√£o, consulte a documenta√ß√£o interativa da API
acessando /docs no endpoint do backend.

================================================================================
  FIM DO DOCUMENTO
================================================================================
